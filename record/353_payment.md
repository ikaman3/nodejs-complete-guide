354_Payment Process

결제 방식에 대한 정보, 보통 신용카드 데이터를 수집하고 정보가 정확한지, 유효기간이 지나지는 않았는지, 신용카드 번호가 정확한지 등을 확인하고 신용카드에 비용을 청구한 후 결제 내역을 관리해야 한다. 예를 들어 사기 결제나 분쟁 등을 관리해야 한다. 마지막으로 앱에서 즉, 서버 측 코드에 주문을 처리해야 한다. 예를 들어 DB에 주문을 저장한다. 결제 관련 문제는 법적인 측면에서나 기술적인 측면에서나 몹시 복잡한 문제이기 때문에 아웃소싱하는 경우가 대부분이다. 

Client(Browser) ----------------> Collect Credit Card Data
    |                                   |
    |                                   |
    |                                   |
    | Token <-------------------- Stripe Servers(3rd Party)
    |                                   ^
    |                                   |
    |                                   |
Server(Node App) ---------------> Create Payment Data

해외에서는 Stripe라는 결제 서비스 회사를 주로 사용한다. 클라이언트에서 신용카드 데이터를 수집할 텐데 Stripe를 통해 수집한 데이터를 Stripe 서버로 보내 서버를 소유한 회사가 입력값을 확인한다. 유효하다면 Stripe를 통해 신용카드 데이터를 암호화한 토큰과 정보가 정확하다는 확인 내역을 보낸다. 그럼 이 서버, 즉 이 코드에 토큰을 보내 신용카드에 청구하거나 다시 Stripe를 통해 결제 방식에 청구한다. 다시 말해 요금 객체를 생성해서 토큰과 가격 정보와 함께 Stripe에 보내면 Stripe가 실제 청구와 관리를 담당하는데 모든 과정이 끝났다는 응답을 받고 나면 다시 코드로 돌아와서 수정하거나 DB에 저장한다.
============================================================================================
355_결제 페이지 추가

앱에 결제 기능 추가를 위해 checkout.ejs 파일을 다룬다. cart.ejs에서 main 안의 코드를 제외하고 복사한다. 우선 shop 파일에 새 라우트를 추가한다. 
    router.get('/checkout', isAuth, shopController.getCheckout);

그리고 shop 컨트롤러에 액션을 추가한다. 논리 상으로 postOrder 전에 추가한다. 

다시 뷰에 필요한 요소를 작성한다. 

* 결제 관련 코드가 변경되어 공식 문서를 확인해서 업데이트가 필요함.
============================================================================================
